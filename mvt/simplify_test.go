package mvt

import (
	"testing"
)

var (
	points = [100][2]float64{
		[2]float64{0.22455, 0.25015}, [2]float64{0.22691, 0.24419}, [2]float64{0.23331, 0.24145}, [2]float64{0.23498, 0.23606},
		[2]float64{0.24421, 0.23276}, [2]float64{0.26259, 0.21531}, [2]float64{0.26776, 0.21381}, [2]float64{0.27357, 0.20184},
		[2]float64{0.27312, 0.19216}, [2]float64{0.27762, 0.18903}, [2]float64{0.28036, 0.18141}, [2]float64{0.28651, 0.17774},
		[2]float64{0.29241, 0.15937}, [2]float64{0.29691, 0.15564}, [2]float64{0.31495, 0.15137}, [2]float64{0.31975, 0.14516},
		[2]float64{0.33033, 0.13757}, [2]float64{0.34148, 0.13996}, [2]float64{0.36998, 0.13789}, [2]float64{0.38739, 0.14251},
		[2]float64{0.39128, 0.13939}, [2]float64{0.40952, 0.14114}, [2]float64{0.41482, 0.13975}, [2]float64{0.42772, 0.12730},
		[2]float64{0.43960, 0.11974}, [2]float64{0.47493, 0.10787}, [2]float64{0.48651, 0.10675}, [2]float64{0.48920, 0.10945},
		[2]float64{0.49379, 0.10863}, [2]float64{0.50474, 0.11966}, [2]float64{0.51296, 0.12235}, [2]float64{0.51863, 0.12089},
		[2]float64{0.52409, 0.12688}, [2]float64{0.52957, 0.12786}, [2]float64{0.53421, 0.14093}, [2]float64{0.53927, 0.14724},
		[2]float64{0.56769, 0.14891}, [2]float64{0.57525, 0.15726}, [2]float64{0.58062, 0.15815}, [2]float64{0.60153, 0.15685},
		[2]float64{0.61774, 0.15986}, [2]float64{0.62200, 0.16704}, [2]float64{0.62955, 0.19460}, [2]float64{0.63890, 0.19561},
		[2]float64{0.64126, 0.20081}, [2]float64{0.65177, 0.20456}, [2]float64{0.67155, 0.22255}, [2]float64{0.68368, 0.21745},
		[2]float64{0.69525, 0.21915}, [2]float64{0.70064, 0.21798}, [2]float64{0.70312, 0.21436}, [2]float64{0.71226, 0.21587},
		[2]float64{0.72149, 0.21281}, [2]float64{0.72781, 0.21336}, [2]float64{0.72998, 0.20873}, [2]float64{0.73532, 0.20820},
		[2]float64{0.73994, 0.20477}, [2]float64{0.76998, 0.20842}, [2]float64{0.77960, 0.21687}, [2]float64{0.78420, 0.21816},
		[2]float64{0.80024, 0.21462}, [2]float64{0.81053, 0.21973}, [2]float64{0.81719, 0.22682}, [2]float64{0.82077, 0.23617},
		[2]float64{0.82723, 0.23616}, [2]float64{0.82989, 0.23989}, [2]float64{0.85100, 0.24894}, [2]float64{0.85988, 0.25549},
		[2]float64{0.86521, 0.26853}, [2]float64{0.85795, 0.28030}, [2]float64{0.86548, 0.29145}, [2]float64{0.86681, 0.29866},
		[2]float64{0.86468, 0.30271}, [2]float64{0.86779, 0.30617}, [2]float64{0.85987, 0.31137}, [2]float64{0.86008, 0.31435},
		[2]float64{0.85829, 0.31494}, [2]float64{0.85810, 0.32760}, [2]float64{0.85454, 0.33540}, [2]float64{0.86092, 0.34300},
		[2]float64{0.85643, 0.35015}, [2]float64{0.85142, 0.35296}, [2]float64{0.84984, 0.35959}, [2]float64{0.85456, 0.36553},
		[2]float64{0.84974, 0.37038}, [2]float64{0.84409, 0.37189}, [2]float64{0.84475, 0.38044}, [2]float64{0.84152, 0.38367},
		[2]float64{0.83957, 0.39040}, [2]float64{0.84559, 0.39905}, [2]float64{0.84840, 0.40755}, [2]float64{0.84371, 0.41130},
		[2]float64{0.84409, 0.41988}, [2]float64{0.83951, 0.43276}, [2]float64{0.84133, 0.44104}, [2]float64{0.84762, 0.44922},
		[2]float64{0.84716, 0.45844}, [2]float64{0.85138, 0.46279}, [2]float64{0.85397, 0.47115}, [2]float64{0.86636, 0.48077},
	}
)

var (
	simplified = [34][2]float64{
		[2]float64{0.22455, 0.25015}, [2]float64{0.26776, 0.21381}, [2]float64{0.29691, 0.15564}, [2]float64{0.33033, 0.13757},
		[2]float64{0.40952, 0.14114}, [2]float64{0.4396, 0.11974}, [2]float64{0.48651, 0.10675}, [2]float64{0.52957, 0.12786},
		[2]float64{0.53927, 0.14724}, [2]float64{0.56769, 0.14891}, [2]float64{0.61774, 0.15986}, [2]float64{0.62955, 0.1946},
		[2]float64{0.67155, 0.22255}, [2]float64{0.72781, 0.21336}, [2]float64{0.73994, 0.20477}, [2]float64{0.76998, 0.20842},
		[2]float64{0.7842, 0.21816}, [2]float64{0.80024, 0.21462}, [2]float64{0.82077, 0.23617}, [2]float64{0.85988, 0.25549},
		[2]float64{0.86521, 0.26853}, [2]float64{0.85795, 0.2803}, [2]float64{0.86779, 0.30617}, [2]float64{0.85829, 0.31494},
		[2]float64{0.85454, 0.3354}, [2]float64{0.86092, 0.343}, [2]float64{0.84984, 0.35959}, [2]float64{0.85456, 0.36553},
		[2]float64{0.84409, 0.37189}, [2]float64{0.83957, 0.3904}, [2]float64{0.8484, 0.40755}, [2]float64{0.83951, 0.43276},
		[2]float64{0.85397, 0.47115}, [2]float64{0.86636, 0.48077},
	}
)

func TestSimplify(t *testing.T) {
	var coords []float64
	for i := 0; i < len(points); i++ {
		coords = append(coords, points[i][0], points[i][1], float64(0))
	}

	coords[2] = 1
	coords[len(coords)-1] = 1
	Simplify(coords, 0, len(coords)-3, 0.001*0.001)

	var result [][]float64
	for i := 0; i < len(coords); i += 3 {
		if coords[i+2] > 0.005*0.005 {
			result = append(result, []float64{coords[i], coords[i+1]})
		}
	}

	if len(result) != len(simplified) {
		t.Error("errr")
	}
}
